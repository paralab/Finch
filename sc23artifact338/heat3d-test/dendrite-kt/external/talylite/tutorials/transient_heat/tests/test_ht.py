#!/usr/bin/env python

import os
import sys

sys.path.append(os.environ['TALYFEM_DIR'] + '/python_scripts')

from test_common import run_tests
from test_common import DEFAULT_PROGRAM_PATH
from test_common import DEFAULT_PROGRAM_ARGS
from test_common import have_mumps
from test_common import all_tests_passed

test_base = {
  "outputExtension": ".plt",
  "basisRelativeOrder": 0
}

# note: these t* numberings are from the old shell script tests.
# the actual test IDs are zero-indexed, so test_id == 0 is the test marked t1, etc.
tests =  [
{
# t1
"__NUM_PROCESSORS": 1,
"__DESCR": "1D,Box,1N,noDD x:L=1(Nel=20),	IC(1), dt(0.001), nOfTS(10) Petsc(default)",
"nsd": 1,
"ifBoxGrid": True,
"basisFunction": "linear",
"ifDD": False,
"Lx": 1,
"Nelemx": 20,
"typeOfIC": 1,
"dt": 0.001,
"nOfTS": 10,
}, 
{
# t2
"__NUM_PROCESSORS": 1,
"__DESCR": "2D,Box,1N,noDD x,y:L=1(Nel=20),	IC(1), dt(0.001), nOfTS(10) Petsc(default)",
"nsd": 2,
"ifBoxGrid": True,
"basisFunction": "linear",
"ifDD": False,
"Lx": 1,
"Nelemx": 20,
"Ly": 1,
"Nelemy": 20,
"typeOfIC": 1,
"dt": 0.001,
"nOfTS": 10,
}, 
{
# t3
"__NUM_PROCESSORS": 1,
"__DESCR": "3D,Box,1N,noDD x,y,z:L=1(Nel=20),	IC(1), dt(0.001), nOfTS(10) Petsc(default)",
"nsd": 3,
"ifBoxGrid": True,
"basisFunction": "linear",
"ifDD": False,
"Lx": 1,
"Nelemx": 20,
"Ly": 1,
"Nelemy": 20,
"Lz": 1,
"Nelemz": 20,
"typeOfIC": 1,
"dt": 0.001,
"nOfTS": 10,
}, 
{
# t4
"__NUM_PROCESSORS": 1,
"__DESCR": "1D,Box,2N,noDD x:L=1(Nel=20),	IC(1), dt(0.001), nOfTS(10) Petsc(default)",
"nsd": 1,
"ifBoxGrid": True,
"basisFunction": "quadratic",
"ifDD": False,
"Lx": 1,
"Nelemx": 20,
"typeOfIC": 1,
"dt": 0.001,
"nOfTS": 10,
}, 
{
# t5
"__NUM_PROCESSORS": 1,
"__DESCR": "2D,Box,2N,noDD x,y:L=1(Nel=20),	IC(1), dt(0.001), nOfTS(10) Petsc(default)",
"nsd": 2,
"ifBoxGrid": True,
"basisFunction": "quadratic",
"ifDD": False,
"Lx": 1,
"Nelemx": 20,
"Ly": 1,
"Nelemy": 20,
"typeOfIC": 1,
"dt": 0.001,
"nOfTS": 10,
}, 
{
# t6
"__NUM_PROCESSORS": 1,
"__DESCR": "3D,Box,2N,noDD x,y,z:L=1(Nel=20),	IC(1), dt(0.001), nOfTS(10) Petsc(default)",
"nsd": 3,
"ifBoxGrid": True,
"basisFunction": "quadratic",
"ifDD": False,
"Lx": 1,
"Nelemx": 20,
"Ly": 1,
"Nelemy": 20,
"Lz": 1,
"Nelemz": 20,
"typeOfIC": 1,
"dt": 0.001,
"nOfTS": 10,
}, 
{
# t7
"__NUM_PROCESSORS": 1,
"__DESCR": "1D,Box,3N,noDD x:L=1(Nel=20),	IC(1), dt(0.001), nOfTS(10) Petsc(default)",
"nsd": 1,
"ifBoxGrid": True,
"basisFunction": "cubic",
"ifDD": False,
"Lx": 1,
"Nelemx": 21,
"typeOfIC": 1,
"dt": 0.001,
"nOfTS": 10,
}, 
{
# t8
"__NUM_PROCESSORS": 1,
"__DESCR": "2D,Box,3N,noDD x,y:L=1(Nel=20),	IC(1), dt(0.001), nOfTS(10) Petsc(default)",
"nsd": 2,
"ifBoxGrid": True,
"basisFunction": "cubic",
"ifDD": False,
"Lx": 1,
"Nelemx": 21,
"Ly": 1,
"Nelemy": 21,
"typeOfIC": 1,
"dt": 0.001,
"nOfTS": 10,
}, 
{
# t9
"__NUM_PROCESSORS": 1,
"__DESCR": "3D,Box,3N,noDD x,y,z:L=1(Nel=20),	IC(1), dt(0.001), nOfTS(10) Petsc(default)",
"nsd": 3,
"ifBoxGrid": True,
"basisFunction": "cubic",
"ifDD": False,
"Lx": 1,
"Nelemx": 21,
"Ly": 1,
"Nelemy": 21,
"Lz": 1,
"Nelemz": 21,
"typeOfIC": 1,
"dt": 0.001,
"nOfTS": 10,
}, 
{
# t10
"__NUM_PROCESSORS": 2,
"__DESCR": "2D,Box,1N,DD x,y:L=1(Nel=20),	IC(1), dt(0.001), nOfTS(10) Petsc(default) Output(all)",
"nsd": 2,
"ifBoxGrid": True,
"basisFunction": "linear",
"ifDD": True,
"Lx": 1,
"Nelemx": 20,
"Ly": 1,
"Nelemy": 20,
"typeOfIC": 1,
"dt": 0.001,
"nOfTS": 10,
}, 
{
# t11
"__NUM_PROCESSORS": 2,
"__DESCR": "2D,Box,1N,DD x,y:L=1(Nel=20),	IC(1), dt(0.001), nOfTS(10) Petsc(default) Output(u,u_analytical)",
"nsd": 2,
"ifBoxGrid": True,
"basisFunction": "linear",
"ifDD": True,
"Lx": 1,
"Nelemx": 20,
"Ly": 1,
"Nelemy": 20,
"typeOfIC": 1,
"dt": 0.001,
"nOfTS": 10,
"varListOutput": "[u,u_analytical]",
}, 
{
# t12
"__NUM_PROCESSORS": 2,
"__DESCR": "2D,Box,1N,noDD x,y,z:L=1(Nel=20),	IC(1), dt(0.001), nOfTS(10) Petsc(default) Output(u,u_analytical)",
"nsd": 2,
"ifBoxGrid": True,
"basisFunction": "linear",
"ifDD": False,
"Lx": 1,
"Nelemx": 20,
"Ly": 1,
"Nelemy": 20,
"typeOfIC": 1,
"dt": 0.001,
"nOfTS": 10,
"varListOutput": "[u,u_analytical]",
}, 
{
# t13
 
"__NUM_PROCESSORS": 2,
"__DESCR": "3D,Box,1N,DD x,y:L=1(Nel=20),	IC(1), dt(0.001), nOfTS(10) Petsc(default) Output(all)",
"nsd": 3,
"ifBoxGrid": True,
"basisFunction": "linear",
"ifDD": True,
"Lx": 1,
"Nelemx": 20,
"Ly": 1,
"Nelemy": 20,
"Lz": 1,
"Nelemz": 20,
"typeOfIC": 1,
"dt": 0.001,
"nOfTS": 10,
}, 
{
# t14
"__NUM_PROCESSORS": 2,
"__DESCR": "3D,Box,1N,DD x,y:L=1(Nel=20),	IC(1), dt(0.001), nOfTS(10) Petsc(default) Output(u,u_analytical)",
"nsd": 3,
"ifBoxGrid": True,
"basisFunction": "linear",
"ifDD": True,
"Lx": 1,
"Nelemx": 20,
"Ly": 1,
"Nelemy": 20,
"Lz": 1,
"Nelemz": 20,
"typeOfIC": 1,
"dt": 0.001,
"nOfTS": 10,
"varListOutput": "[u,u_analytical]",
}, 
{
# t15
"__NUM_PROCESSORS": 2,
"__DESCR": "3D,Box,1N,noDD x,y,z:L=1(Nel=20),	IC(1), dt(0.001), nOfTS(10) Petsc(default) Output(u,u_analytical)",
"nsd": 3,
"ifBoxGrid": True,
"basisFunction": "linear",
"ifDD": False,
"Lx": 1,
"Nelemx": 20,
"Ly": 1,
"Nelemy": 20,
"Lz": 1,
"Nelemz": 20,
"typeOfIC": 1,
"dt": 0.001,
"nOfTS": 10,
"varListOutput": "[u,u_analytical]",
}, 
{
# t16
"__NUM_PROCESSORS": 2,
"__PROGRAM_ARGS": ["-ksp_type", "preonly", "-pc_type", "lu", "-pc_factor_mat_solver_package", "mumps"],
"__DESCR": "2D,Box,1N,DD x,y:L=1(Nel=20),	IC(1), dt(0.001), nOfTS(10) Petsc(mumps) Output(all)",
"nsd": 2,
"ifBoxGrid": True,
"basisFunction": "linear",
"ifDD": True,
"Lx": 1,
"Nelemx": 20,
"Ly": 1,
"Nelemy": 20,
"typeOfIC": 1,
"dt": 0.001,
"nOfTS": 10,
}, 
{
# t17
"__NUM_PROCESSORS": 2,
"__PROGRAM_ARGS": ["-ksp_type", "preonly", "-pc_type", "lu", "-pc_factor_mat_solver_package", "mumps"],
"__DESCR": "3D,Box,1N,DD x,y:L=1(Nel=20),	IC(1), dt(0.001), nOfTS(10) Petsc(mump) Output(u,u_analytical)",
"nsd": 3,
"ifBoxGrid": True,
"basisFunction": "linear",
"ifDD": True,
"Lx": 1,
"Nelemx": 20,
"Ly": 1,
"Nelemy": 20,
"Lz": 1,
"Nelemz": 20,
"typeOfIC": 1,
"dt": 0.001,
"nOfTS": 10,
"varListOutput": "[u,u_analytical]",
}, 
{
# t18
"__NUM_PROCESSORS": 2,
"__DESCR": "2D,Box,1N,noDD x,y:L=1(Nel=20),	IC(0-data_init_2D.plt) Output(all) Input(All)",
"__COPY_FILES": "data_init_2D_t18.plt",
"nsd": 2,
"ifBoxGrid": True,
"basisFunction": "linear",
"ifDD": False,
"Lx": 1,
"Nelemx": 20,
"Ly": 1,
"Nelemy": 20,
"typeOfIC": 0,
"dt": 0.001,
"nOfTS": 10,
"inputFilenameGridField": "data_init_2D_t18.plt",
}, 
{
# t19
"__NUM_PROCESSORS": 2,
"__DESCR": "2D,Box,1N,noDD x,y:L=1(Nel=20),	IC(0-data_init_2D.plt) Output(all) Input(All-but only u,u_analytical available)",
"__COPY_FILES": "data_init_2D_t19.plt",
"nsd": 2,
"ifBoxGrid": True,
"basisFunction": "linear",
"ifDD": False,
"Lx": 1,
"Nelemx": 20,
"Ly": 1,
"Nelemy": 20,
"typeOfIC": 0,
"dt": 0.001,
"nOfTS": 10,
"inputFilenameGridField": "data_init_2D_t19.plt",
}, 
{
# t20
"__NUM_PROCESSORS": 2,
"__DESCR": "2D,Box,1N,noDD x,y:L=1(Nel=20),	IC(0-data_init_2D.plt) Output(all) Input(u - available u,u_analytical)",
"__COPY_FILES": "data_init_2D_t20.plt",
"nsd": 2,
"ifBoxGrid": True,
"basisFunction": "linear",
"ifDD": False,
"Lx": 1,
"Nelemx": 20,
"Ly": 1,
"Nelemy": 20,
"typeOfIC": 0,
"dt": 0.001,
"nOfTS": 10,
"inputFilenameGridField": "data_init_2D_t20.plt",
"varListInput ": "[u]",
}, 
{
# t21
"__NUM_PROCESSORS": 2,
"__DESCR": "2D,Box,1N,noDD x,y:L=1(Nel=20),	IC(0-data_init_2D.plt) Output(u,u_analytical) Input(u available u,u_analytical)",
"__COPY_FILES": "data_init_2D_t21.plt",
"nsd": 2,
"ifBoxGrid": True,
"basisFunction": "linear",
"ifDD": False,
"Lx": 1,
"Nelemx": 20,
"Ly": 1,
"Nelemy": 20,
"typeOfIC": 0,
"dt": 0.001,
"nOfTS": 10,
"inputFilenameGridField": "data_init_2D_t21.plt",
"varListInput ": "[u]",
"varListOutput ": "[u,u_analytical]",
}, 
{
# t22
"__NUM_PROCESSORS": 2,
"__DESCR": "2D,Box,1N,noDD x,y:L=1(Nel=20),	IC(0-data_init_2D.plt) Output(u) Input(u available: u,u_analytical)",
"__COPY_FILES": "data_init_2D_t22.plt",
"nsd": 2,
"ifBoxGrid": True,
"basisFunction": "linear",
"ifDD": False,
"Lx": 1,
"Nelemx": 20,
"Ly": 1,
"Nelemy": 20,
"typeOfIC": 0,
"dt": 0.001,
"nOfTS": 10,
"inputFilenameGridField": "data_init_2D_t22.plt",
"varListInput ": "[u]",
"varListOutput ": "[u]",
}, 
{
# t23
"__NUM_PROCESSORS": 2,
"__DESCR": "2D,Box,1N,noDD x,y:L=1(Nel=20),	IC(0-data_init_2D.plt) Output(u) Input(u,u_analytical available: u), SHOULD FAIL ",
"__COPY_FILES": "data_init_2D_t23.plt",
"nsd": 2,
"ifBoxGrid": True,
"basisFunction": "linear",
"ifDD": False,
"shouldFail": True,
"Lx": 1,
"Nelemx": 20,
"Ly": 1,
"Nelemy": 20,
"typeOfIC": 0,
"dt": 0.001,
"nOfTS": 10,
"inputFilenameGridField": "data_init_2D_t23.plt",
"varListInput ": "[u,u_analytical]",
"varListOutput ": "[u]",
}, 
{
# t24
"__NUM_PROCESSORS": 2,
"__DESCR": "2D,Box,1N,DD x,y:L=1(Nel=20),	IC(0-data_init_2D.plt) Output(all) Input(All)",
"__COPY_FILES": "data_init_2D_t24.plt",
"nsd": 2,
"ifBoxGrid": True,
"basisFunction": "linear",
"ifDD": True,
"Lx": 1,
"Nelemx": 20,
"Ly": 1,
"Nelemy": 20,
"typeOfIC": 0,
"dt": 0.001,
"nOfTS": 10,
"inputFilenameGridField": "data_init_2D_t24.plt",
}, 
{
# t25
"__NUM_PROCESSORS": 2,
"__DESCR": "2D,Box,1N,DD x,y:L=1(Nel=20),	IC(0-data_init_2D.plt) Output(all) Input(All-but only u,u_analytical available)",
"__COPY_FILES": "data_init_2D_t25.plt",
"nsd": 2,
"ifBoxGrid": True,
"basisFunction": "linear",
"ifDD": True,
"Lx": 1,
"Nelemx": 20,
"Ly": 1,
"Nelemy": 20,
"typeOfIC": 0,
"dt": 0.001,
"nOfTS": 10,
"inputFilenameGridField": "data_init_2D_t25.plt",
}, 
{
# t26
"__NUM_PROCESSORS": 2,
"__DESCR": "2D,Box,1N,DD x,y:L=1(Nel=20),	IC(0-data_init_2D.plt) Output(all) Input(u - available u,u_analytical)",
"__COPY_FILES": "data_init_2D_t26.plt",
"nsd": 2,
"ifBoxGrid": True,
"basisFunction": "linear",
"ifDD": True,
"Lx": 1,
"Nelemx": 20,
"Ly": 1,
"Nelemy": 20,
"typeOfIC": 0,
"dt": 0.001,
"nOfTS": 10,
"inputFilenameGridField": "data_init_2D_t26.plt",
"varListInput ": "[u]",
}, 
{
# t27
"__NUM_PROCESSORS": 2,
"__DESCR": "2D,Box,1N,DD x,y:L=1(Nel=20),	IC(0-data_init_2D.plt) Output(u,u_analytical) Input(u available u,u_analytical)",
"__COPY_FILES": "data_init_2D_t27.plt",
"nsd": 2,
"ifBoxGrid": True,
"basisFunction": "linear",
"ifDD": True,
"Lx": 1,
"Nelemx": 20,
"Ly": 1,
"Nelemy": 20,
"typeOfIC": 0,
"dt": 0.001,
"nOfTS": 10,
"inputFilenameGridField": "data_init_2D_t27.plt",
"varListInput ": "[u]",
"varListOutput ": "[u,u_analytical]",
}, 
{
# t28
"__NUM_PROCESSORS": 2,
"__DESCR": "2D,Box,1N,DD x,y:L=1(Nel=20),	IC(0-data_init_2D.plt) Output(u) Input(u available: u,u_analytical)",
"__COPY_FILES": "data_init_2D_t28.plt",
"nsd": 2,
"ifBoxGrid": True,
"basisFunction": "linear",
"ifDD": True,
"Lx": 1,
"Nelemx": 20,
"Ly": 1,
"Nelemy": 20,
"typeOfIC": 0,
"dt": 0.001,
"nOfTS": 10,
"inputFilenameGridField": "data_init_2D_t28.plt",
"varListInput ": "[u]",
"varListOutput ": "[u]",
}, 
{
# t29
"__NUM_PROCESSORS": 2,
"__DESCR": "2D,Box,1N,DD x,y:L=1(Nel=20),	IC(0-data_init_2D.plt) Output(u) Input(u,u_analytical available: u), SHOULD FAIL",
"__COPY_FILES": "data_init_2D_t29.plt",
"nsd": 2,
"ifBoxGrid": True,
"basisFunction": "linear",
"ifDD": True,
"shouldFail": True,
"Lx": 1,
"Nelemx": 20,
"Ly": 1,
"Nelemy": 20,
"typeOfIC": 0,
"dt": 0.001,
"nOfTS": 10,
"inputFilenameGridField": "data_init_2D_t29.plt",
"varListInput ": "[u,u_analytical]",
"varListOutput ": "[u]",
}, 
{
# t30
 
"__NUM_PROCESSORS": 2,
"__DESCR": "2D,Box,2N,DD x,y:L=1(Nel=20),	IC(1), dt(0.001), nOfTS(10) Petsc(default)",
"nsd": 2,
"ifBoxGrid": True,
"basisFunction": "quadratic",
"ifDD": True,
"Lx": 1,
"Nelemx": 20,
"Ly": 1,
"Nelemy": 20,
"typeOfIC": 1,
"dt": 0.001,
"nOfTS": 10,
}, 
{
# t31
 
"__NUM_PROCESSORS": 2,
"__DESCR": "3D,Box,2N,DD x,y,z:L=1(Nel=20),	IC(1), dt(0.001), nOfTS(10) Petsc(default)",
"nsd": 3,
"ifBoxGrid": True,
"basisFunction": "quadratic",
"ifDD": True,
"Lx": 1,
"Nelemx": 20,
"Ly": 1,
"Nelemy": 20,
"Lz": 1,
"Nelemz": 20,
"typeOfIC": 1,
"dt": 0.001,
"nOfTS": 10,
}, 
{
# t32
 
"__NUM_PROCESSORS": 2,
"__DESCR": "2D,Box,3N,DD x,y:L=1(Nel=20),	IC(1), dt(0.001), nOfTS(10) Petsc(default)",
"nsd": 2,
"ifBoxGrid": True,
"basisFunction": "cubic",
"ifDD": True,
"Lx": 1,
"Nelemx": 21,
"Ly": 1,
"Nelemy": 21,
"typeOfIC": 1,
"dt": 0.001,
"nOfTS": 10,
}, 
{
# t33
"__NUM_PROCESSORS": 2,
"__DESCR": "3D,Box,3N,DD x,y,z:L=1(Nel=20),	IC(1), dt(0.001), nOfTS(10) Petsc(default)",
"nsd": 3,
"ifBoxGrid": True,
"basisFunction": "cubic",
"ifDD": True,
"Lx": 1,
"Nelemx": 21,
"Ly": 1,
"Nelemy": 21,
"Lz": 1,
"Nelemz": 21,
"typeOfIC": 1,
"dt": 0.001,
"nOfTS": 10,
}, 
{
# t34
"__NUM_PROCESSORS": 2,
"__DESCR": "2D,Box,1N,noDD x,y:L=1(Nel=20),triangleEl	IC(1), dt(0.001), nOfTS(10) Petsc(default)",
"nsd": 2,
"ifBoxGrid": True,
"ifTriElem": 1,
"basisFunction": "linear",
"ifDD": False,
"Lx": 1,
"Nelemx": 20,
"Ly": 1,
"Nelemy": 20,
"typeOfIC": 1,
"dt": 0.001,
"nOfTS": 10,
},
{
# t35
"__NUM_PROCESSORS": 1,
"__DESCR": "2D, not box, no DD, load grid shape from file, no indicators",
"__COPY_FILES": "grid_2D_no_indicators.plt",
"nsd": 2,
"ifBoxGrid": False,
"basisFunction": "linear",
"ifDD": False,
"Lx": 1,
"Nelemx": 20,
"Ly": 1,
"Nelemy": 20,
"typeOfIC": 1,
"dt": 0.001,
"nOfTS": 10,
"inputFilenameGrid": "grid_2D_no_indicators.plt",
"ifWriteNodeIndicators": True,
"varListInput ": "[u]",
"varListOutput ": "[u,u_analytical]",
},
{
# t36
"__NUM_PROCESSORS": 2,
"__DESCR": "2D, not box, DD, load grid shape from file, no indicators  SHOULD FAIL",
"__COPY_FILES": "grid_2D_no_indicators.plt",
"nsd": 2,
"ifBoxGrid": False,
"basisFunction": "linear",
"ifDD": True,
"Lx": 1,
"Nelemx": 20,
"Ly": 1,
"Nelemy": 20,
"typeOfIC": 1,
"dt": 0.001,
"nOfTS": 10,
"shouldFail": True,
"inputFilenameGrid": "grid_2D_no_indicators.plt",
"ifLoadNodeIndicators": True,
"varListInput ": "[u]",
"varListOutput ": "[u,u_analytical]",
},
{
# t37
"__NUM_PROCESSORS": 4,
"__DESCR": "2D, not box, DD, load grid shape from file with indicators",
"__COPY_FILES": "grid_2D_with_indicators.plt",
"nsd": 2,
"ifBoxGrid": False,
"basisFunction": "linear",
"ifDD": True,
"Lx": 1,
"Nelemx": 20,
"Ly": 1,
"Nelemy": 20,
"typeOfIC": 1,
"dt": 0.001,
"nOfTS": 10,
"inputFilenameGrid": "grid_2D_with_indicators.plt",
"ifLoadNodeIndicators": True,
# "ifWriteNodeIndicators": True,
"varListInput ": "[u]",
"varListOutput ": "[u,u_analytical]",
},
{
# t38 - testing elemental assembly
"__NUM_PROCESSORS": 1,
"__DESCR": "3D,Box,2N,noDD x,y:L=1(Nel=20),elemental,	IC(1), dt(0.001), nOfTS(10) Petsc(default)",
"nsd": 3,
"ifBoxGrid": True,
"basisFunction": "quadratic",
"ifDD": False,
"Lx": 1,
"Nelemx": 20,
"Ly": 1,
"Nelemy": 20,
"Lz": 1,
"Nelemz": 20,
"typeOfIC": 1,
"dt": 0.001,
"nOfTS": 10,
"use_elemental_assembly": 1,
},
{
# t39 - testing vector only assembly
"__NUM_PROCESSORS": 1,
"__DESCR": "3D,Box,2N,noDD x,y:L=1(Nel=20),vector_only,	IC(1), dt(0.001), nOfTS(10) Petsc(default)",
"nsd": 3,
"ifBoxGrid": True,
"basisFunction": "quadratic",
"ifDD": False,
"Lx": 1,
"Nelemx": 20,
"Ly": 1,
"Nelemy": 20,
"Lz": 1,
"Nelemz": 20,
"typeOfIC": 1,
"dt": 0.001,
"nOfTS": 10,
"use_vector_only_assembly": 1,
},
{
# t40 - testing both elemental and vector only assembly
"__NUM_PROCESSORS": 1,
"__DESCR": "3D,Box,2N,noDD x,y:L=1(Nel=20),elemental,vector_only,	IC(1), dt(0.001), nOfTS(10) Petsc(default)",
"nsd": 3,
"ifBoxGrid": True,
"basisFunction": "quadratic",
"ifDD": False,
"Lx": 1,
"Nelemx": 20,
"Ly": 1,
"Nelemy": 20,
"Lz": 1,
"Nelemz": 20,
"typeOfIC": 1,
"dt": 0.001,
"nOfTS": 10,
"use_vector_only_assembly": 1,
"use_elemental_assembly": 1,
},

# Gmsh tests

# Gmsh, 2D box
{
# t41
"__NUM_PROCESSORS": 1,
"__DESCR": "Gmsh loader, 2D box, order 1",
"__COPY_FILES": "gmsh/2d_box_order1.msh",
"nsd": 2,
"ifDD": False,
"ifBoxGrid": False,
"basisFunction": "linear",
"typeOfIC": 1,
"inputFilenameGrid": "2d_box_order1.msh",
"ifLoadNodeIndicators": True,
"dt": 0.001,
"nOfTS": 10,
},
{
# t42
"__NUM_PROCESSORS": 1,
"__DESCR": "Gmsh loader, 2D box, order 2",
"__COPY_FILES": "gmsh/2d_box_order2.msh",
"nsd": 2,
"ifDD": False,
"ifBoxGrid": False,
"basisFunction": "quadratic",
"typeOfIC": 1,
"inputFilenameGrid": "2d_box_order2.msh",
"ifLoadNodeIndicators": True,
"dt": 0.001,
"nOfTS": 10,
},
{
# t43
"__NUM_PROCESSORS": 1,
"__DESCR": "Gmsh loader, 2D box, order 3",
"__COPY_FILES": "gmsh/2d_box_order3.msh",
"nsd": 2,
"ifDD": False,
"ifBoxGrid": False,
"basisFunction": "cubic",
"typeOfIC": 1,
"inputFilenameGrid": "2d_box_order3.msh",
"ifLoadNodeIndicators": True,
"dt": 0.001,
"nOfTS": 10,
},

# Gmsh, 3D hexahedron
{
# t44
"__NUM_PROCESSORS": 1,
"__DESCR": "Gmsh loader, 3D hex, order 1",
"__COPY_FILES": "gmsh/3d_hex_order1.msh",
"nsd": 3,
"ifDD": False,
"ifBoxGrid": False,
"basisFunction": "linear",
"typeOfIC": 1,
"inputFilenameGrid": "3d_hex_order1.msh",
"ifLoadNodeIndicators": True,
"dt": 0.001,
"nOfTS": 10,
},
{
# t45
"__NUM_PROCESSORS": 1,
"__DESCR": "Gmsh loader, 3D hex, order 2",
"__COPY_FILES": "gmsh/3d_hex_order2_small.msh",
"nsd": 3,
"ifDD": False,
"ifBoxGrid": False,
"basisFunction": "quadratic",
"typeOfIC": 1,
"inputFilenameGrid": "3d_hex_order2_small.msh",
"ifLoadNodeIndicators": True,
"dt": 0.001,
"nOfTS": 10,
},
{
# t46
"__NUM_PROCESSORS": 1,
"__DESCR": "Gmsh loader, 3D hex, order 3",
"__COPY_FILES": "gmsh/3d_hex_order3_small.msh",
"nsd": 3,
"ifDD": False,
"ifBoxGrid": False,
"basisFunction": "cubic",
"typeOfIC": 1,
"inputFilenameGrid": "3d_hex_order3_small.msh",
"ifLoadNodeIndicators": True,
"dt": 0.001,
"nOfTS": 10,
},

# Gmsh, 2D triangle
{
# t47
"__NUM_PROCESSORS": 1,
"__DESCR": "Gmsh loader, 2D triangle, order 1",
"__COPY_FILES": "gmsh/2d_tri.msh",
"nsd": 2,
"ifDD": False,
"ifBoxGrid": False,
"basisFunction": "linear",
"typeOfIC": 1,
"inputFilenameGrid": "2d_tri.msh",
"ifLoadNodeIndicators": True,
"dt": 0.001,
"nOfTS": 10,
},

# Gmsh, 3D tetrahedron
{
# t48
"__NUM_PROCESSORS": 1,
"__DESCR": "Gmsh loader, 3D tetrahedron, order 1",
"__COPY_FILES": "gmsh/3d_tet.msh",
"nsd": 3,
"ifDD": False,
"ifBoxGrid": False,
"basisFunction": "linear",
"typeOfIC": 1,
"inputFilenameGrid": "3d_tet.msh",
"ifLoadNodeIndicators": True,
"dt": 0.001,
"nOfTS": 10,
},

# Gmsh, Domain Decomposition
{
# t49
"__NUM_PROCESSORS": 2,
"__DESCR": "Gmsh loader, DD, 3D hex, order 1",
"__COPY_FILES": "gmsh/3d_hex_order1.msh",
"nsd": 3,
"ifDD": True,
"ifBoxGrid": False,
"basisFunction": "linear",
"typeOfIC": 1,
"inputFilenameGrid": "3d_hex_order1.msh",
"ifLoadNodeIndicators": True,
"dt": 0.001,
"nOfTS": 10,
},
{
# t50
"__NUM_PROCESSORS": 2,
"__DESCR": "Gmsh loader, DD, 3D hex, order 2",
"__COPY_FILES": "gmsh/3d_hex_order2_small.msh",
"nsd": 3,
"ifDD": True,
"ifBoxGrid": False,
"basisFunction": "quadratic",
"typeOfIC": 1,
"inputFilenameGrid": "3d_hex_order2_small.msh",
"ifLoadNodeIndicators": True,
"dt": 0.001,
"nOfTS": 10,
},
{
# t51
"__NUM_PROCESSORS": 2,
"__DESCR": "Gmsh loader, DD, 2D triangle, order 1",
"__COPY_FILES": "gmsh/2d_tri.msh",
"nsd": 2,
"ifDD": True,
"ifBoxGrid": False,
"basisFunction": "linear",
"typeOfIC": 1,
"inputFilenameGrid": "2d_tri.msh",
"ifLoadNodeIndicators": True,
"dt": 0.001,
"nOfTS": 10,
},
{
# t52
"__NUM_PROCESSORS": 2,
"__DESCR": "Gmsh loader, DD, 3D tetrahedron, order 1 (can't loadd surfaces)",
"__COPY_FILES": "gmsh/3d_tet.msh",
"nsd": 3,
"ifDD": True,
"ifBoxGrid": False,
"basisFunction": "linear",
"typeOfIC": 1,
"inputFilenameGrid": "3d_tet.msh",
"ifLoadNodeIndicators": True,
"dt": 0.001,
"nOfTS": 10,
},
{
# t53
"__NUM_PROCESSORS": 4,
"__DESCR": "2D, DD, load grid shape from file with indicators - windows line endings",
"__COPY_FILES": "windows_line_endings.plt",
"nsd": 2,
"ifBoxGrid": False,
"basisFunction": "linear",
"ifDD": True,
"typeOfIC": 1,
"dt": 0.001,
"nOfTS": 10,
"inputFilenameGrid": "windows_line_endings.plt",
"ifLoadNodeIndicators": True,
"varListInput ": "[u]",
"varListOutput ": "[u,u_analytical]",
},
{
# t54
"__NUM_PROCESSORS": 1,
"__DESCR": "2D, no DD, load grid shape from file with indicators - windows line endings",
"__COPY_FILES": "windows_line_endings.plt",
"nsd": 2,
"ifBoxGrid": False,
"basisFunction": "linear",
"ifDD": False,
"typeOfIC": 1,
"dt": 0.001,
"nOfTS": 10,
"inputFilenameGrid": "windows_line_endings.plt",
"ifLoadNodeIndicators": True,
"varListInput ": "[u]",
"varListOutput ": "[u,u_analytical]",
},
]


# add the test_base to every entry
tests = [ dict(test_base.items() + t.items()) for t in tests ]

PROGRAM_PATH = DEFAULT_PROGRAM_PATH
EXECUTABLE_PATH = os.environ['EXECUTABLE_PATH']
PROGRAM_ARGS = DEFAULT_PROGRAM_ARGS + ["-n", "__NUM_PROCESSORS", EXECUTABLE_PATH]

if not have_mumps():
  for test in tests:
    if "__PROGRAM_ARGS" in test and "mumps" in test["__PROGRAM_ARGS"]:
      test["__SKIP"] = "MUMPS not installed"

results = run_tests(tests, PROGRAM_PATH, PROGRAM_ARGS)
sys.exit(0 if all_tests_passed(results) else 1)

