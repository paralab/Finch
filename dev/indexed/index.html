<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Indexed variables · Finch</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="Finch logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">Finch</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Documentation for Finch</a></li><li><a class="tocitem" href="../start/">Getting started</a></li><li><span class="tocitem">Usage</span><ul><li><a class="tocitem" href="../configuration/">Configuration</a></li><li><a class="tocitem" href="../mesh/">Mesh</a></li><li><a class="tocitem" href="../entities/">Entities</a></li><li><a class="tocitem" href="../conditions/">Boundary and Initial Conditions</a></li><li><a class="tocitem" href="../equation/">Equation Input</a></li><li><a class="tocitem" href="../solution/">Solution and Output</a></li><li><a class="tocitem" href="../reorder/">Reordering</a></li><li><a class="tocitem" href="../misc/">Other Interface Functions</a></li></ul></li><li><a class="tocitem" href="../examples/">Examples</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Indexed variables</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Indexed variables</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/paralab/Finch/blob/master/docs/src/indexed.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Indexed-variables"><a class="docs-heading-anchor" href="#Indexed-variables">Indexed variables</a><a id="Indexed-variables-1"></a><a class="docs-heading-anchor-permalink" href="#Indexed-variables" title="Permalink"></a></h1><img src="../assets/images/addiff1dindexed.png" alt="addiff1dindexed" width="400"><p>The Julia script: <a href="https://github.com/paralab/Finch/blob/master/src/examples/example-addiff1d-indexed.jl">example-addiff1d-indexed.jl</a></p><p>When solving a large number of equations with the same form, but different values, this feature greatly simplifies the input process and generated code. It also presents the possibility of arranging the assembly loops in different ways. The example shown here may not be the most meaningful case, but is easy to understand. It is an advection diffusion equation with a range of advection speeds and diffusion rates. It is solved using the finite volume method with upwinding for the advective flux. Since the equations are the same for each set of values, the variables are indexed in a single expression.</p><p>Begin by importing and using the Finch module. Then initialize. The name here is only used when generating code files.</p><pre><code class="nohighlight hljs">using Finch
initFinch(&quot;FVadvection2d&quot;);</code></pre><p>Then set up the configuration. This example sets dimensionality of the domain and the solver type(FV).</p><pre><code class="nohighlight hljs">domain(2) 		# dimension
solverType(FV)	# FV for finite volume
timeStepper(RK4)# time stepper</code></pre><p>Use the built-in simple mesh generator to make the mesh and set up all node mappings.</p><pre><code class="nohighlight hljs">n = 60 # number of elements in each direction
mesh(LINEMESH, elsperdim=n, bids=2)</code></pre><p>Before defining any variables, set up the indices using the <code>index()</code> command. At the same time, it will be convenient to build corresponding arrays of expressions for initial and boundary conditions. This has been omitted here for clarity.</p><pre><code class="nohighlight hljs">nspeeds = 5 # number of different advection speeds
ndiffs = 4  # number of diffusion rates
speed = index(&quot;speed&quot;, range = [1,nspeeds])
diff = index(&quot;diff&quot;, range = [1,ndiffs])</code></pre><p>Define the variable and coefficient symbols using the type keyword VAR<em>ARRAY and the previously defined index objects. The indexed coefficients will also need the type VAR</em>ARRAY.</p><pre><code class="nohighlight hljs">u = variable(&quot;u&quot;, VAR_ARRAY, CELL, index = [speed, diff])

coefficient(&quot;a&quot;, speeds, VAR_ARRAY) # advection velocity
coefficient(&quot;d&quot;, diffs, VAR_ARRAY) # diffusion rate</code></pre><p>The PDE must be in a conservation form for finite volume. Note the <code>[speed, diff]</code> indices on u and the respective indices on a and d.</p><pre><code class="nohighlight hljs"># The conservation type equation
conservationForm(u, &quot;surface(upwind(a[speed],u[speed, diff]) - d[diff] * dot(grad(u[speed, diff]),normal()))&quot;)</code></pre><p>The assembly code is generated by nesting the elemental and indexed loops in the desired order. The outermost loop is first.</p><pre><code class="nohighlight hljs">assemblyLoops([&quot;elements&quot;, speed, diff])
solve(u);</code></pre><p>End things with <code>finalizeFinch()</code> to finish up any generated files and the log.</p></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Saturday 29 October 2022 00:10">Saturday 29 October 2022</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
